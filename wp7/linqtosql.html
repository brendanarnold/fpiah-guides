
<!DOCTYPE html>
<html>
  <head>
    <title>Linq-To-SQL - Windows Phone Development For People In a Hurry</title>

    <script type="text/javascript">
    
    </script>
    <script src="js/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="styles/style.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="js/highlight/styles/github.css" type="text/css">

    <style type="text/css">
    
    </style>

  </head>
  <body>
    <ul id="nav">
        <li><a href="index.html">Home</a></li>
    </ul>

    <div id="mainbody">

    <h2 id="tagline">Windows Phone Development for People in a Hurry</h2>

    <h1>Linq-To-SQL</h1>

    <p>Linq-To-SQL is an <a href="glossary.html#orm">Object-Relational-Mapper (ORM)</a>, i.e. a way of saving and retrieving C# objects to and from a database</p>

    <a name="relationaldatabases"></a>
    <h2>Relational Databases</h2>

    <ul>
      <li>The local database used in Windows Phone is a 'relational database'</li>
      <li>A relational database consists of a set of tables</li>
      <li>Each table is tailored for a particular object type with each row representing one object and each column representing  a property of the object</li>
      <li>There is also an additional column containing a unique ID for the object (usually an integer)</li>
      <li>N.b. Windows Phone also adds another column for the version. This is to speed up the code when updating the database and is not essential for relational databases in general</li>
    </ul>
  
    <a name="onetomany"></a>
    <h3>One-To-One and One-to-Many mapping</h3>

    <ul>
      <li>Often objects feature another object as a property. The property column in this case just feature the ID for the attached object. This is known as a 'foreign key'</li>
      <li>The referenced object may be referenced by several objects which is known as a One-To-Many mapping. If it is only reference by one object then it is a One-To-One mapping</li>
      <li>An example is a <code>Customer</code> may have many <code>Order</code> objects, but each <code>Order</code> only belongs to one <code>Customer</code>, hence Many-To-One</li>
      <li>In this example the foreign key is set in the <code>Order</code> table. Miss Smith has made one order, Mr Jones has made 3 orders</li>
    </ul>

    <table>
      <caption>Customer table</caption>
      <tr>
        <th>Id</th><th>Name</th>
      </tr>
        <td>1</td><td>Mr Jones</td>
      <tr>
      </tr>
      <tr>
        <td>2</td><td>Miss Smith</td>
      </tr>
    </table>

    <table>
      <caption>Order table</caption>
      <tr>
        <th>Id</th><th>Item</th><th>Price</th><th>Customer_Id</th>
      </tr>
      <tr>
        <td>1</td><td>Fun Bus - Memoirs of a Conductor</td><td>4.99</td><td>1</td>
      </tr>
      <tr>
        <td>2</td><td>Cooking with Marmite</td><td>5.99</td><td>1</td>
      </tr>
      <tr>
        <td>3</td><td>My Great Life In Provence</td><td>5.99</td><td>2</td>
      </tr>
      <tr>
        <td>5</td><td>Pocket Guide to Pockets</td><td>1.99</td><td>1</td>
      </tr>
    </table>

    <a name="manytomany"></a>
    <h3>Many-To-Many mapping</h3>

    <ul>
      <li>There are some cases where you may want a 'Many-to-Many' relationship. e.g. A <code>Book</code> may be bought by many <code>Customer</code> and a <code>Customer</code> may have bought many <code>Book</code></li>
      <li>This can be represented in relational databases using a separate 'join table' which consists of two columns, a foreign key for the <code>Book</code> Id and a foreign key for the <code>Customer</code> Id and there is a row for every relationship</li>
      <li>This is not easily supported in Linq-To-SQL and you should probably consider making the relationship more simple</li>
    </ul>
        
<a name="orm"></a>
<h2>Linq-To-SQL ORM</h2>

<ul>
  <li>An ORM takes the objects and reads/writes them to the database</li>
  <li>To avoid too many slow database read/write operations, the ORM also caches the changes until you ask for them to be committed</li>
  <li>Linq-To-SQL for Windows Phone also provides access to the database via <a href="csharp.html#linq">Linq</a> so abstracting the programmer away from <a name="glossary.html#sql">SQL statements</a></li>
  <li>In fact, one of the limitations of Linq-To-SQL for Windows Phone is that SQL cannot be executed directly</li>
</ul>

<a name="implementation"></a>
<h2>Implementation</h2>

<ul>
  <li>An object is created which represents the ORM. This inherits from an object called (confusingly) 'DataContext' which has nothing to do with the <a href="binding.html#datacontext">DataContext to do with Binding</a></li>
  <li>Various <a href="glossary.html#attributecsharp">C# attributes</a> are assigned to the Model objects that will be stored in the database</li>
  <li>Moreover, the object should also implement the <code>INotifyPropertyChanging</code> interface to keep the ORM current with changes on the object</li>
  <li><a href="glossary.html#entityreferences">Entity References</a> need to be defined on objects where there is a foreign key relation</li>
</ul>

<p>You now should be comfortable tackling the <a href="http://msdn.microsoft.com/en-us/library/hh286405.aspx">'How to create a local database app with MVVM for Windows Phone' walkthrough</a> which implements the code described above</p>

    </div>
  </body>
</html>
